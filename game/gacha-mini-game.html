<!doctype html>

<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Machine 3x3 Mini Game - OneDev Entertainment</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="stylesheet" href="../styles.css" />
<link rel="stylesheet" href="../menu.css" />
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
#slotContainer { max-width: 400px; margin:20px auto; padding:15px; background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; position:relative;}
.reels { display:grid; grid-template-columns:repeat(3,1fr); grid-gap:8px; margin-bottom:15px; position:relative;}
.reel { width:100%; padding-top:100%; position:relative; background:#f3f3f3; border:2px solid #ccc; border-radius:8px; font-size:2rem; display:flex; justify-content:center; align-items:center; transition:transform 0.1s;}
.reel.blur { filter:blur(3px) brightness(1.2);}
.reel span { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);}
.payline { position:absolute; width:100%; height:4px; background:rgba(255,0,0,0.5); pointer-events:none; z-index:2; display:none; animation:blink 0.8s infinite;}
@keyframes blink {0%,100%{opacity:1;}50%{opacity:0.3;}}
#coinDisplay, #usernameDisplay { font-weight:bold;}
#coinDisplay { color:green; margin-left:10px;}
button { padding:10px 25px; font-size:16px; margin:5px; cursor:pointer; border-radius:6px; border:none; background:#007bff; color:white;}
button:hover { background:#0056b3; }
#result { font-size:16px; font-weight:bold; margin-top:10px; white-space: pre-line; text-align:left; }
.highlight { background:yellow; border:2px solid orange; border-radius:8px; }
#betPopup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:5; }
#betPopup .popup-content { background:#fff; padding:20px; border-radius:12px; text-align:center; }
#leaderboard { margin-top:15px; text-align:left; font-size:14px; }
</style>
</head>
<body>
<header class="nav">
<div class="nav-inner">
  <div class="brand"><div class="logo">OD</div><span class="brand-name">OneDev</span></div>
  <nav class="menu" id="menu"></nav>
  <button id="burger" class="burger" aria-label="menu"><span></span><span></span><span></span></button>
</div>
</header><div class="sidebar"><div class="sidebar-content"></div></div>
<div class="sidebar-overlay"></div><main class="hero">
<div class="container">
<section class="hero-left">
<h1 class="hi">Slot Machine 3x3 Mini Game</h1>
<p>Login dengan Google untuk mulai bermain!</p><div id="slotContainer">
  <div id="loginDiv">
    <div id="g_id_onload"
         data-client_id="101739742549-opkcpkqcdrs1d4t38e5qdqvoi0luistd.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin"></div>
  </div>  <div id="gameDiv" style="display:none;">
    <p>Username: <span id="usernameDisplay"></span></p>
    <p>Coins: <span id="coinDisplay">100</span></p><div class="reels" id="reelsContainer">
  <div class="reel"><span>üçí</span></div>
  <div class="reel"><span>üçã</span></div>
  <div class="reel"><span>üçä</span></div>
  <div class="reel"><span>‚≠ê</span></div>
  <div class="reel"><span>üíé</span></div>
  <div class="reel"><span>üí∞</span></div>
  <div class="reel"><span>üçí</span></div>
  <div class="reel"><span>üçã</span></div>
  <div class="reel"><span>üçä</span></div>
</div>

<div id="payline" class="payline"></div>

<button id="spinBtn">Start Spin üé∞</button>
<button id="topUpBtn">Top Up Coin</button>
<button id="exchangeBtn">Exchange ke GTKRPS</button>
<button id="logoutBtn">Logout</button>

<div id="leaderboard"><strong>Leaderboard:</strong><br/></div>
<p id="result"></p>

  </div>
</div>
</section>
</div>
</main><div id="betPopup"><div class="popup-content"><p>Pilih taruhan:</p>
<button class="betBtn">10</button>
<button class="betBtn">20</button>
<button class="betBtn">30</button>
<button class="betBtn">40</button>
<button class="betBtn">50</button>
<button class="betBtn">60</button>
<button class="betBtn">70</button>
<button class="betBtn">80</button>
<button class="betBtn">90</button>
<button class="betBtn">100</button>
</div></div><footer class="footer">&copy; 2025 OneDev Entertainment. All rights reserved.</footer><script src="../menu.js"></script><script>
let username=""; let coins=100; let leaderboard={}; let currentBet=10;
const reelsEl=Array.from(document.querySelectorAll(".reel span"));
const symbols=["üçí","üçã","üçä","‚≠ê","üíé","üí∞"];
const spinSound=new Audio("https://freesound.org/data/previews/341/341695_6246950-lq.mp3");
const jackpotSound=new Audio("https://freesound.org/data/previews/341/341693_6246950-lq.mp3");
const paylineEl=document.getElementById("payline");

function handleCredentialResponse(response){
  const payload=JSON.parse(atob(response.credential.split('.')[1]));
  username=payload.name;
  document.getElementById("loginDiv").style.display="none";
  document.getElementById("gameDiv").style.display="block";
  document.getElementById("usernameDisplay").textContent=username;
  updateCoins(); updateLeaderboard();
}

function showBetPopup(){ document.getElementById("betPopup").style.display="flex"; }
function hideBetPopup(){ document.getElementById("betPopup").style.display="none"; }

document.querySelectorAll(".betBtn").forEach(btn=>{
  btn.addEventListener("click",()=>{ currentBet=parseInt(btn.textContent); hideBetPopup(); spinSlot(); });
});

document.getElementById("spinBtn").addEventListener("click",showBetPopup);
document.getElementById("topUpBtn").addEventListener("click",()=>{ alert("Silakan lakukan Top Up di halaman pembayaran."); });
document.getElementById("exchangeBtn").addEventListener("click",()=>{ window.location.href="/gtkrps/exchange.html"; });
document.getElementById("logoutBtn").addEventListener("click",()=>{ google.accounts.id.disableAutoSelect(); location.reload(); });

function updateCoins(){ document.getElementById("coinDisplay").textContent=coins; }

function updateLeaderboard(){
  leaderboard[username]=coins;
  const sorted=Object.entries(leaderboard).sort((a,b)=>b[1]-a[1]);
  document.getElementById("leaderboard").innerHTML="<strong>Leaderboard:</strong><br/>"+
    sorted.map(e=>`${e[0]}: ${e[1]} coins`).join("<br/>");
}

function spinSlot(){
  if(coins<currentBet){ alert("Coin tidak cukup!"); return; }
  coins-=currentBet; updateCoins();
  document.getElementById("spinBtn").disabled=true;
  spinSound.currentTime=0; spinSound.play();
  reelsEl.forEach(r=>r.parentElement.classList.add("blur"));

  let spinCounts=Array(9).fill(0);
  const targetSpin=spinCounts.map(()=>15+Math.floor(Math.random()*15));
  const interval=setInterval(()=>{
    reelsEl.forEach((reel, idx)=>{
      if(spinCounts[idx]<targetSpin[idx]){
        reel.textContent=symbols[Math.floor(Math.random()*symbols.length)];
        spinCounts[idx]++;
      }
    });
    if(spinCounts.every((v,i)=>v>=targetSpin[i])){
      clearInterval(interval);
      reelsEl.forEach(r=>r.parentElement.classList.remove("blur"));
      finalizeSpin();
      document.getElementById("spinBtn").disabled=false;
    }
  },80);
}

function finalizeSpin(){
  const values=reelsEl.map(r=>r.textContent);
  const counts={}; values.forEach(s=>counts[s]=(counts[s]||0)+1);

  let bonus=0, msg="";
  if(Object.values(counts).includes(9)){ bonus=900; msg=`üé∞ JACKPOT! 9 simbol sama!`; jackpotSound.play(); showPayline(); }
  else if(Object.values(counts).includes(8)){ bonus=800; msg=`üéâ SUPER BONUS!`; showPayline(); }
  else if(Object.values(counts).includes(7)){ bonus=500; msg=`üéâ BONUS!`; showPayline(); }
  else if(Object.values(counts).includes(6)){ bonus=300; msg=`‚ú® BONUS!`; showPayline(); }
  else if(Object.values(counts).includes(5)){ bonus=200; msg=`‚ú® SMALL BONUS!`; showPayline(); }
  else if(Object.values(counts).includes(4)){ bonus=100; msg=`üéâ MINI BONUS!`; showPayline(); }
  else if(Object.values(counts).includes(3)){ bonus=50; msg=`üéâ WIN!`; showPayline(); }
  else { bonus=0; msg="Tidak ada bonus."; }

  if(bonus>0){ coins+=bonus*currentBet; msg+=`\nüí∞ Kamu menang ${bonus*currentBet} coins!`; }

  document.getElementById("result").textContent=msg;
  updateCoins(); updateLeaderboard();
}

function showPayline(){ paylineEl.style.display="block"; setTimeout(()=>paylineEl.style.display="none",1500); }

</script></body>
</html>