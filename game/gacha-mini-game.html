<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gacha Mini Game - OneDev Entertainment</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="../menu.css" />
  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* Gacha Container */
    #gachaContainer {
      max-width: 700px;
      margin: 20px auto;
      padding: 15px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    #gachaContainer h2 { margin-bottom: 15px; }

    #gachaContainer .boxes {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .box {
      background: #eee;
      padding: 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      user-select: none;
    }

    .box:hover {
      transform: scale(1.1);
      background: #ddd;
    }

    #coinDisplay {
      font-weight: bold;
      color: green;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      margin: 8px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #007bff;
      color: white;
    }

    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <div class="logo">OD</div>
        <span class="brand-name">OneDev</span>
      </div>

      <!-- Desktop menu (di-generate otomatis) -->
      <nav class="menu" id="menu"></nav>

      <!-- Burger -->
      <button id="burger" class="burger" aria-label="menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- Sidebar mobile -->
  <div class="sidebar">
    <div class="sidebar-content"></div>
  </div>
  <div class="sidebar-overlay"></div>

  <!-- Main Content -->
  <main class="hero">
    <div class="container">
      <section class="hero-left">
        <h1 class="hi">Gacha Mini Game</h1>
        <p>Login dengan Google untuk mulai bermain!</p>

        <!-- Gacha Container -->
        <div id="gachaContainer">
          <!-- Login Google -->
          <div id="loginDiv">
            <div id="g_id_onload"
                 data-client_id="101739742549-opkcpkqcdrs1d4t38e5qdqvoi0luistd.apps.googleusercontent.com"
                 data-callback="handleCredentialResponse">
            </div>
            <div class="g_id_signin"></div>
          </div>

          <!-- Game Area -->
          <div id="gachaDiv" style="display:none;">
            <p id="welcome"></p>
            <p>Coins: <span id="coinDisplay">100</span></p>

            <form id="gachaForm">
              <div class="boxes" id="boxes"></div>
              <button type="button" id="topUpBtn">Top Up Coin</button>
            </form>

            <p id="result"></p>
          </div>
        </div>
      </section>

      <section class="hero-right">
        <div class="hex-wrap">
          <div class="hex-border">
            <img src="assets/profile.jpg" alt="Team" class="profile" />
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    &copy; 2025 OneDev Entertainment. All rights reserved.
  </footer>

  <!-- Scripts -->
  <script src="../menu.js"></script>
  <script>
    let username = "";
    let coins = 100;
    const totalBoxes = 10;
    const boxesEl = document.getElementById("boxes");

    // Login Google
    function handleCredentialResponse(response) {
      const payload = JSON.parse(atob(response.credential.split('.')[1]));
      username = payload.name;

      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("gachaDiv").style.display = "block";
      document.getElementById("welcome").textContent = `Selamat datang, ${username}`;

      initBoxes();
      updateCoins();
    }

    // Update coins
    function updateCoins() {
      document.getElementById("coinDisplay").textContent = coins;
    }

    // Initialize boxes
    function initBoxes() {
      boxesEl.innerHTML = "";
      // buat array isi 3 bom, 7 coin
      const items = Array(3).fill("Bom").concat(Array(7).fill("Coin"));
      shuffleArray(items);

      items.forEach((item, index) => {
        const box = document.createElement("div");
        box.className = "box";
        box.textContent = "?";
        box.dataset.value = item;
        box.addEventListener("click", () => selectBox(box));
        boxesEl.appendChild(box);
      });
    }

    // Shuffle helper
    function shuffleArray(array) {
      for (let i = array.length -1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Box clicked
    function selectBox(box) {
      if(box.classList.contains("opened")) return;
      box.classList.add("opened");

      if(box.dataset.value === "Bom") {
        box.style.background = "red";
        box.textContent = "ðŸ’£";
        coins = Math.max(0, coins - 50);
        document.getElementById("result").textContent = `${username} kena BOM! Coins berkurang 50!`;
      } else {
        box.style.background = "gold";
        box.textContent = "ðŸ’°";
        coins += 50;
        document.getElementById("result").textContent = `${username} mendapatkan COIN +50!`;
      }

      updateCoins();
    }

    // Top Up Button
    document.getElementById("topUpBtn").addEventListener("click", () => {
      alert("Silakan lakukan Top Up di halaman pembayaran.");
    });
  </script>
</body>
</html>