<!doctype html>

<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Machine 3x3 Mini Game - OneDev Entertainment</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="stylesheet" href="../styles.css" />
<link rel="stylesheet" href="../menu.css" />
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
#slotContainer { max-width: 400px; margin:20px auto; padding:15px; background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; position:relative;}
.reels { display:grid; grid-template-columns:repeat(3,1fr); grid-gap:8px; margin-bottom:15px; position:relative;}
.reel { width:100%; padding-top:100%; position:relative; background:#f3f3f3; border:2px solid #ccc; border-radius:8px; font-size:2rem; display:flex; justify-content:center; align-items:center; transition:transform 0.1s;}
.reel.blur { filter:blur(3px) brightness(1.2);}
.reel span { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);}
.payline { position:absolute; width:100%; height:4px; background:rgba(255,0,0,0.5); pointer-events:none; z-index:2; display:none; animation:blink 0.8s infinite;}
@keyframes blink {0%,100%{opacity:1;}50%{opacity:0.3;}}
#coinDisplay, #usernameDisplay { font-weight:bold;}
#coinDisplay { color:green; margin-left:10px;}
button { padding:10px 25px; font-size:16px; margin:8px; cursor:pointer; border-radius:6px; border:none; background:#007bff; color:white;}
button:hover { background:#0056b3; }
#result { font-size:16px; font-weight:bold; margin-top:15px; white-space: pre-line; text-align:left; }
.highlight { background:yellow; border:2px solid orange; border-radius:8px; }
</style>
</head>
<body>
<header class="nav">
<div class="nav-inner">
  <div class="brand"><div class="logo">OD</div><span class="brand-name">OneDev</span></div>
  <nav class="menu" id="menu"></nav>
  <button id="burger" class="burger" aria-label="menu"><span></span><span></span><span></span></button>
</div>
</header><div class="sidebar"><div class="sidebar-content"></div></div>
<div class="sidebar-overlay"></div><main class="hero">
<div class="container">
<section class="hero-left">
<h1 class="hi">Slot Machine 3x3 Mini Game</h1>
<p>Login dengan Google untuk mulai bermain!</p><div id="slotContainer">
  <div id="loginDiv">
    <div id="g_id_onload"
         data-client_id="101739742549-opkcpkqcdrs1d4t38e5qdqvoi0luistd.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin"></div>
  </div>  <div id="gameDiv" style="display:none;">
    <p>Username: <span id="usernameDisplay"></span></p>
    <p>Coins: <span id="coinDisplay">100</span></p><div class="reels" id="reelsContainer">
  <div class="reel"><span>üçí</span></div>
  <div class="reel"><span>üçã</span></div>
  <div class="reel"><span>üçä</span></div>
  <div class="reel"><span>‚≠ê</span></div>
  <div class="reel"><span>üíé</span></div>
  <div class="reel"><span>üí∞</span></div>
  <div class="reel"><span>üçí</span></div>
  <div class="reel"><span>üçã</span></div>
  <div class="reel"><span>üçä</span></div>
</div>

<div id="payline" class="payline"></div>

<button id="spinBtn">Start Spin üé∞</button>
<button id="topUpBtn">Top Up Coin</button>
<button id="logoutBtn">Logout</button>

<p id="result"></p>

  </div>
</div>
</section>
</div>
</main><footer class="footer">&copy; 2025 OneDev Entertainment. All rights reserved.</footer><script src="../menu.js"></script><script>
let username = "";
let coins = 100;
let leaderboard = {};
const reelsEl = Array.from(document.querySelectorAll(".reel span"));
const symbols = ["üçí","üçã","üçä","‚≠ê","üíé","üí∞"];
const spinSound = new Audio("https://freesound.org/data/previews/341/341695_6246950-lq.mp3");
const jackpotSound = new Audio("https://freesound.org/data/previews/341/341693_6246950-lq.mp3");
const paylineEl = document.getElementById("payline");

function handleCredentialResponse(response){
  const payload = JSON.parse(atob(response.credential.split('.')[1]));
  username = payload.name;
  document.getElementById("loginDiv").style.display = "none";
  document.getElementById("gameDiv").style.display = "block";
  document.getElementById("usernameDisplay").textContent = username;
  updateCoins(); updateLeaderboard();
}

function spinSlot(){
  if(coins<10){ alert("Coin tidak cukup! Silakan Top Up."); return; }

  coins -= 10; updateCoins();
  document.getElementById("spinBtn").disabled = true;
  spinSound.currentTime=0; spinSound.play();
  reelsEl.forEach(r=>r.parentElement.classList.add("blur"));

  let spinCounts = Array(9).fill(0);
  const targetSpin = spinCounts.map(()=> 15+Math.floor(Math.random()*15));

  const interval = setInterval(()=>{
    reelsEl.forEach((reel, idx)=>{
      if(spinCounts[idx]<targetSpin[idx]){
        reel.textContent = symbols[Math.floor(Math.random()*symbols.length)];
        spinCounts[idx]++;
      }
    });
    if(spinCounts.every((v,i)=>v>=targetSpin[i])){
      clearInterval(interval);
      reelsEl.forEach(r=>r.parentElement.classList.remove("blur"));
      finalizeSpin();
      document.getElementById("spinBtn").disabled = false;
    }
  },80);
}

function finalizeSpin(){
  const values = reelsEl.map(r=>r.textContent);
  const counts = {};
  values.forEach(s=>counts[s]=(counts[s]||0)+1);

  let bonus=0, msg="";
  if(Object.values(counts).includes(9)){ bonus=900; msg=`üé∞ JACKPOT! 9 simbol sama!`; jackpotSound.play(); showPayline(); }
  else if(Object.values(counts).includes(8)){ bonus=800; msg=`üéâ SUPER BONUS! 8 simbol sama!`; showPayline(); }
  else if(Object.values(counts).includes(7)){ bonus=500; msg=`üéâ BONUS! 7 simbol sama!`; showPayline(); }
  else if(Object.values(counts).includes(6)){ bonus=300; msg=`‚ú® BONUS! 6 simbol sama!`; showPayline(); }
  else if(Object.values(counts).includes(5)){ bonus=200; msg=`‚ú® SMALL BONUS! 5 simbol sama!`; showPayline(); }
  else if(Object.values(counts).includes(4)){ bonus=100; msg=`üéâ MINI BONUS! 4 simbol sama!`; showPayline(); }
  else if(Object.values(counts).includes(3)){ bonus=50; msg=`üéâ WIN! 3 simbol sama!`; showPayline(); }
  else { bonus=0; msg="Tidak ada bonus."; }

  // Pop-up coin tambahan
  if(bonus>0){ showCoinPopup(bonus); }

  coins+=bonus; updateCoins();
  highlightLines(values);
  updateLeaderboard();
  showResult(msg);
}

function showCoinPopup(baseBonus){
  const overlay = document.createElement("div");
  overlay.style.position="fixed"; overlay.style.top="0"; overlay.style.left="0";
  overlay.style.width="100%"; overlay.style.height="100%";
  overlay.style.background="rgba(0,0,0,0.6)";
  overlay.style.display="flex"; overlay.style.justifyContent="center"; overlay.style.alignItems="center";
  overlay.style.zIndex="999";
  
  const popup = document.createElement("div");
  popup.style.background="#fff"; popup.style.padding="20px"; popup.style.borderRadius="12px"; popup.style.textAlign="center";
  popup.innerHTML = `<h3>Pilih Coin Bonus!</h3>`;
  
  const buttons = [10,20,30,40,50,60,70,80,90,100];
  buttons.forEach(val=>{
    const btn = document.createElement("button");
    btn.textContent = `+${val} COIN`;
    btn.style.margin="5px";
    btn.onclick = () => { coins+=val; updateCoins(); document.body.removeChild(overlay); };
    popup.appendChild(btn);
  });
  
  overlay.appendChild(popup);
  document.body.appendChild(overlay);
}

function updateCoins(){ document.getElementById("coinDisplay").textContent=coins; }
function updateLeaderboard(){ leaderboard[username]=coins; displayLeaderboard(); }
function displayLeaderboard(){
  const entries = Object.entries(leaderboard).sort((a,b)=>b[1]-a[1]);
  let text="üèÜ Leaderboard Coin:\n";
  entries.slice(0,5).forEach(([user,coin],idx)=>text+=`${idx+1}. ${user}: ${coin} COIN\n`);
  if(entries.length>0) text+=`\nüéñ Pemenang saat ini: ${entries[0][0]} dengan ${entries[0][1]} COIN!`;
  document.getElementById("result").textContent=text;
}

function highlightLines(values){
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,4,8],[2,4,6]];
  lines.forEach(line=>{
    const [a,b,c] = line;
    if(values[a]===values[b] && values[a]===values[c]){
      line.forEach(i=>reelsEl[i].parentElement.classList.add("highlight"));
      setTimeout(()=>line.forEach(i=>reelsEl[i].parentElement.classList.remove("highlight")),2000);
    }
  });
}

function showPayline(){ paylineEl.style.display="block"; setTimeout(()=>paylineEl.style.display="none",1800); }
function showResult(text){ const resultEl=document.getElementById("result"); resultEl.textContent=text+"\n"+resultEl.textContent; }

document.getElementById("spinBtn").addEventListener("click", spinSlot);
document.getElementById("topUpBtn").addEventListener("click",()=>alert("Silakan lakukan Top Up di halaman pembayaran."));
document.getElementById("logoutBtn").addEventListener("click",()=>{ google.accounts.id.disableAutoSelect(); location.reload(); });
</script></body>
</html>